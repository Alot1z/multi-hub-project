name: 🚀 Ultra Simple Upload System

on:
  workflow_dispatch:
    inputs:
      folders:
        description: 'Folders to upload (or "all")'
        required: true
        default: 'all'
        type: string

jobs:
  upload:
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout
        uses: actions/checkout@v4
        
      - name: 🔧 Setup
        run: sudo apt-get install -y jq
        
      - name: 🚀 Upload folders with upload-path.json
        env:
          UPLOAD_PATH: ${{ secrets.UPLOAD_PATH }}
        run: |
          # Find all upload-path.json files
          find . -name "upload-path.json" -type f | while read config_file; do
            folder=$(dirname "$config_file")
            folder_name=$(basename "$folder")
            
            echo "📁 Processing: $folder_name"
            
            # Skip if not in target list
            if [[ "${{ github.event.inputs.folders }}" != "all" ]] && [[ "${{ github.event.inputs.folders }}" != *"$folder_name"* ]]; then
              echo "⏭️ Skipping $folder_name"
              continue
            fi
            
            # Read URL
            url=$(jq -r '.url' "$config_file")
            
            if [[ "$url" == "PLACEHOLDER" ]]; then
              echo "⚠️ Skipping $folder_name - URL not set"
              echo "💡 Change 'PLACEHOLDER' to your GitHub repo URL"
              continue
            fi
            
            # Extract owner/repo
            if [[ "$url" =~ github\.com/([^/]+)/([^/]+) ]]; then
              owner="${BASH_REMATCH[1]}"
              repo="${BASH_REMATCH[2]}"
              echo "🎯 Target: $owner/$repo"
            else
              echo "❌ Invalid URL: $url"
              continue
            fi
            
            # Clone target repo
            temp_dir="/tmp/${repo}_$$"
            echo "📥 Cloning $owner/$repo..."
            
            if ! git clone "https://x-access-token:${UPLOAD_PATH}@github.com/${owner}/${repo}.git" "$temp_dir"; then
              echo "❌ Failed to clone. Check your UPLOAD_PATH token!"
              continue
            fi
            
            cd "$temp_dir"
            
            # Configure git
            git config user.name "Upload Bot"
            git config user.email "bot@github.com"
            
            # Clear all files except .git
            echo "🧹 Clearing existing files..."
            find . -maxdepth 1 ! -name '.git' ! -name '.' ! -name '..' -exec rm -rf {} + 2>/dev/null || true
            
            # Copy ALL content from source folder
            echo "📤 Copying all files from $folder..."
            cp -r "${GITHUB_WORKSPACE}/${folder}"/* . 2>/dev/null || true
            cp -r "${GITHUB_WORKSPACE}/${folder}"/.[^.]* . 2>/dev/null || true
            
            # Remove upload-path.json from target
            rm -f upload-path.json
            
            # Show what we're uploading
            echo "📊 Files to upload:"
            ls -la
            
            # Add and commit
            git add .
            
            if git diff --staged --quiet; then
              echo "ℹ️ No changes for $folder_name"
            else
              echo "💾 Committing..."
              git commit -m "🚀 Auto upload from 
